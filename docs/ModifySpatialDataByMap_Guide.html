<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"><meta name="charset" content="utf-8"><link rel="stylesheet" type="text/css" href="/style.css"><title> </title></head><body class="bg-primary"><div class="header blue-base"><nav class="navbar blue-base navbar-expand"><a class="navbar-brand" href="/index.html">VELMA 2.2 HOME</a><ul class="navbar-nav no-bullets"><li class="nav-item"><a class="nav-link" href="/intro.html"><span>I. Intro</span></a></li><li class="nav-item"><a class="nav-link" href="/changes.html"><span>II. Changes from 1.0</span></a></li><li class="nav-item"><a class="nav-link" href="/about.html"><span>III. About</span></a></li><li class="nav-item"><a class="nav-link" href="/input_files.html"><span>IV. Input Files </span></a></li><li class="nav-item"><a class="nav-link" href="/new_sim_config.html"><span>V. Sim Config</span></a></li><li class="nav-item"><a class="nav-link" href="/parameter_config.html"><span>VI. Parameter Config</span></a></li><li class="nav-item dropdown">Appendicies<ul class="nav-dropdown blue-light"><li class="nav-item"><a class="nav-link" href="/appendix_1.html"><span>Appendix 1</span></a></li><li class="nav-item"><a class="nav-link" href="/appendix_2.html"><span>Appendix 2</span></a></li><li class="nav-item"><a class="nav-link" href="/appendix_3.html"><span>Appendix 3</span></a></li><li class="nav-item"><a class="nav-link" href="/appendix_4.html"><span>Appendix 4</span></a></li><li class="nav-item"><a class="nav-link" href="/appendix_5.html"><span>Appendix 5</span></a></li><li class="nav-item"><a class="nav-link" href="/appendix_6.html"><span>Appendix 6</span></a></li><li class="nav-item"><a class="nav-link" href="/appendix_7.html"><span>Appendix 7</span></a></li></ul></li><li class="nav-item dropdown">Supplemental <ul class="nav-dropdown blue-light"><li class="nav-item"><a class="nav-link" href="/supplement-a1.html"><span>Supplement A1</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-a2.html"><span>Supplement A2</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-a3.html"><span>Supplement A3</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-a4.html"><span>Supplement A4</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b1.html"><span>Supplement B1</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b2.html"><span>Supplement B2</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b3.html"><span>Supplement B3</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b4.html"><span>Supplement B4</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b5.html"><span>Supplement B5</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b6.html"><span>Supplement B6</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b7.html"><span>Supplement B7</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b8.html"><span>Supplement B8</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b9.html"><span>Supplement B9</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b10.html"><span>Supplement B10</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-c1.html"><span>Supplement C1</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-c2.html"><span>Supplement C2</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-c3.html"><span>Supplement C3</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d1.html"><span>Supplement D1</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d2.html"><span>Supplement D2</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d3.html"><span>Supplement D3</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d4.html"><span>Supplement D4</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d5.html"><span>Supplement D5</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d6.html"><span>Supplement D6</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d7a.html"><span>Supplement D7a</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d7b.html"><span>Supplement D7b</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d8.html"><span>Supplement D8</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d9.html"><span>Supplement D9</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d10.html"><span>Supplement D10</span></a></li></ul></li><li class="nav-item dropdown"> <a class="nav-link" href="/dev_info.html"><span>Developer Info</span></a><ul class="nav-dropdown blue-light"><li class="nav-item"><a class="nav-link" href="/GetVelma_ForEclipse.html"><span>Clone Github to Local Machine</span></a></li><li class="nav-item"><a class="nav-link" href="/CellSpecificBurnDisturbance_Configuration_Guide.html"><span>Cell Specific Burn Disturbance Config Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/Configuration_Checker_Guide.html"><span>Configuration Checker Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/DefaultSedimentModel_Configuration_Guide.html"><span>Default Sediment Model Config Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/Sediment_Output_Data_Summary.html"><span>Sediment Output Data Summary</span></a></li><li class="nav-item"><a class="nav-link" href="/ForestBurnLsrDisturbanceModel_Overview.html"><span>Forest Burn LSR Disturbance Model</span></a></li><li class="nav-item"><a class="nav-link" href="/JPDEM_ReachMapping_Demonstration.html"><span>JPDEM Reaching Mapping Demo</span></a></li><li class="nav-item"><a class="nav-link" href="/MinMaxAirT_WeatherDrivers.html"><span>Min Max Air Temp Weather Drivers</span></a></li><li class="nav-item"><a class="nav-link" href="/ModifySpatialDataByMap_Guide.html"><span>Modify Spatial Data by Map Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/ObsRunoff_and_NaNs.html"><span>OBS Runnoff and NaNs</span></a></li><li class="nav-item"><a class="nav-link" href="/OrganicContaminant_Overview.html"><span>Organic Contaminant Overview</span></a></li><li class="nav-item"><a class="nav-link" href="/OrganicContaminant_Remediation_Configuration_Guide.html"><span>Organic Contaminant Redemption Config Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/OrganicContaminant_Tracer_Configuration_Guide.html"><span>Organic Contaminant Tracter Config Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/ReachSpecificObservedRunnoff.html"><span>Reach Specific Observed Runnoff</span></a></li><li class="nav-item"><a class="nav-link" href="/SnowDepth_Initialization_Guide.html"><span>Snow Depth Initialization Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/TopoFiles_Output_Summary.html"><span>Topo Files Output Summary </span></a></li><li class="nav-item"><a class="nav-link" href="/VelmaParallel_Error_Reports.html"><span>Velma Parallel Error Reports</span></a></li><li class="nav-item"><a class="nav-link" href="/VelmaParallel_With_Multiple_Maps.html"><span>Velma Parallel With Multiple Maps </span></a></li><li class="nav-item"><a class="nav-link" href="/WaterDrainDisturbanceModel_Overview.html"><span>Water Drain Disturbance Model</span></a></li><li class="nav-item"><a class="nav-link" href="/VelmaSimulatorCmdLine_Overview.html"><span>Velma Sim Cmd Line Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/VelmaSimulatorAltCmdLine_Overview.html"><span>Velma Sim Alt Cmd Line Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/SurfaceEvaporation_Overview.html"><span>Surface Evaporation Overview</span></a></li></ul></li><li class="nav-item dropdown"> <a class="nav-link" href="/dev_utils.html"><span>Developer Utils</span></a><ul class="nav-dropdown blue-light"><li class="nav-item"><a class="nav-link" href="/AscMapOct_Guide.html"><span>Ascii Map Oct Guide </span></a></li><li class="nav-item"><a class="nav-link" href="/AscRangeMask_Guide.html"><span>Ascii Range Mask Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/MoeVelGenerator_Guide.html"><span>MOEA-to-VELMA Configuration Generator</span></a></li><li class="nav-item"><a class="nav-link" href="/NashSutcliffeCalculator_Guide.html"><span>Tool for Computing Nash-Sutcliffe Coefficients</span></a></li><li class="nav-item"><a class="nav-link" href="/NseQuarts_Guide.html"><span>NseQuarts Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/VelmaSimRunner_QuickRef.html"><span>VelmaSimRunner Quick Reference</span></a></li><li class="nav-item"><a class="nav-link" href="/VelmaSimRunner.html"><span>VelmaSimRunner Full Guide</span></a></li></ul></li></ul></nav></div><div class="main_body container"><h1>Modifying a VELMA SpatialData Pool Using Grid ASCII Map Data</h1><h2>Overview</h2><p>The contents of a VELMA simulator spatial data pool can be modified at an arbitrary simulation step, or at multiple steps, by specifying "Modify Spatial Data By Map" (shorthand term: "Modify-By-Map") disturbances as part of a simulator run's simulation configuration. Each spatial data pool (and each layer of that pool for multi-layer pools) that is modified must have a separate disturbance specified and parameterized for it, and its own Grid ASCII (.asc) map file available for the disturbance to use as a data source.</p><h2>Requirements</h2><ul><li>One Modify-By-Map item parameterization per spatial data pool, layer, and modification. (Modifying multiple layers of a single spatial data pool requires multiple Modify-By-Map item parameterizations.)</li><li>One Grid ASCII (.asc) map file per Modify-By-Map item parameterization.</li><li>The .asc map file must have the same dimensions as the simulation's specified DEM Grid file.</li><li>The .asc map file's values may be positive or negative, but units for the values are assumed to match the units of the targeted spatial data pool. <em>No</em> error-checking or validation of the values is performed.</li></ul><h3>Adding a Modify-By-Map Disturbance to a Simulation Configuration</h3><ol><li>In JVelma, with a simulation configuration created or loaded, click/open the menu item: <code>Edit</code> -> <code>Disturbances</code> -> <code>Add a Disturbance</code> <br><br></li><li>In the Disturbance Model Selector dialog, scroll down through the drop-down selector items list to <code>ModifySpatialDataByMapDisturbanceModel</code> and click/set it as the Disturbance Type. <br><br></li><li>In the text box next to the "Disturbance Name" prompt, type a name for this specific disturbance.<br> The name must be unique, and must also be an valid Xml identifier (e.g., cannot start with a numeral).<br> Best practice when selecting a name: avoid whitespaces (use underscore '_' characters instead) and (apart from hyphen and underscore) eschew non-alphanumeric characters. <br><br></li><li>Click the dialog's OK button.<br> This closes the dialog, and adds a new Modify-By-Map item parameterization to your simulation configuration</li></ol><h3>Configuring a Modify-By-Map Disturbance's Parameters</h3><p>Modify-By-Map parameters specify ...</p><ul><li><em>When</em> the modification should occur,</li><li>The <em>source</em> for modification data (i.e. the Grid .asc map file to use),</li><li>The <em>target</em> spatial data pool to modify,</li><li><em>How</em> the source data map's values should modify the target spatial data pool's values. (The Modify-By-Map item parameterization also contains a <em>metadata</em> parameter, but its value should be left untouched.)</li></ul><h4><em>When</em> Parameters</h4><table><thead><tr><th>Parameter Name</th><th>Expected Value</th><th>Description</th><th>Can leave blank?</th></tr></thead><tbody><tr><td><code>initializeActiveLoops</code></td><td>One-based Loop number(s)</td><td>The disturbance can occur only in listed Loops</td><td>NO</td></tr><tr><td><code>initializeActiveYears</code></td><td>Full-digits Year number(s)</td><td>The disturbance can occur only in listed Years</td><td>NO</td></tr><tr><td><code>initializeActiveJdays</code></td><td>Julian day(s)</td><td>The disturbance occurs for every listed Jday</td><td>NO</td></tr><tr><td><code>occursAtStepStart</code></td><td>"true" or "false" (without quotes)</td><td>determines whether the disturbance occurs at the beginning or the end of simulation steps</td><td>NO</td></tr></tbody></table><p>The following rules apply to values for the Loop, Year, and Jdays parameters.</p><ul><li>All values must be positive integers.</li><li>The parameter value as whole may consist of:<ul><li>a single value (e.g. 1)</li><li>a range (e.g. 1999-2010)</li><li>or a list of values and/or ranges (e.g. 1, 32, 59, 100-205, 365, 366)</li></ul></li><li>Lists elements must be comma-separated.</li><li>Loop values outside of the [1, <code>numberOfLoops</code>] are ignored.</li><li>Year values must be full values (e.g. the "99" is treated as the year 99, <em>not</em> the year 1999).</li><li>Year values outside the range of the simulation configuration's [<code>syear</code>, <code>eyear</code>] (start year and end year) parameter values are ignored.</li><li>Jday values outside the range [1, 366] are ignored, and the value 366 is ignore in non-leap years.</li></ul><h4><em>Source</em> Parameters</h4><table><thead><tr><th>Parameter Name</th><th>Expected Value</th><th>Description</th><th>Can leave blank?</th></tr></thead><tbody><tr><td><code>spatialDataFileFullName</code></td><td>A filename</td><td>The full or partial path+name of a valid Grid ASCII (.asc) map file</td><td>NO</td></tr></tbody></table><p>Unless the specified filename is a fully-specified path + name, it is assumed to be relative to the directory, location specified by the simulation configuration's <code>inputDataLocationRootName</code>/<code>inputDataLocationDirName</code> pair of parameters.</p><p>Use forward slash “/” characters as path separators. Also, be very careful with whitespace; if there is any, it must exactly match whatever whitespace is present in the actual path and filename.</p><h4><em>Target</em> Parameters</h4><table><thead><tr><th>Parameter Name</th><th>Expected Value</th><th>Description</th><th>Can leave blank?</th></tr></thead><tbody><tr><td><code>spatialDataName</code></td><td>A SpatialData keynames</td><td>The name of the spatial data pool to modify</td><td>NO</td></tr><tr><td><code>spatialDataLayer</code></td><td>One-based layer index number</td><td>The layer of the SpatialData</td><td>NO</td></tr></tbody></table><p>When the <code>spatialDataName</code> value specifies a single-layer spatial data pool, the <code>spatialDataLayer</code> value <em>must</em> be set to 1. Setting <code>spatialDataLayer</code> to a value > the number of layers in a spatial data pool <em>is not</em> caught during simulation initialization, but <em>will</em> cause a runtime error.</p><p>VELMA SpatialData pool keynames are listed in a separate document.</p><h4><em>How</em> Parameters</h4><table><thead><tr><th>Parameter Name</th><th>Expected Value</th><th>Description</th><th>Can leave blank?</th></tr></thead><tbody><tr><td><code>setCellOutcome</code></td><td>"AUGMENT" or "REPLACE" (without quotes)</td><td>Determines if target value is augmented or replaced by source value</td><td>NO</td></tr><tr><td><code>setMapValueMode</code></td><td>"VALUE" or "FRACTION" (without quotes)</td><td>Determines if source value should be treated as a fraction or not</td><td>NO</td></tr></tbody></table><p>Combining the <code>setCellOutcome</code> and <code>setMapValueMode</code> parameter's values determines which of the four possible operations a given Modify-By-Map item performs:</p><table><thead><tr><th><code>setCellOutcome</code></th><th><code>setMapValueMode</code></th><th>Operation Performed</th></tr></thead><tbody><tr><td>AUGMENT</td><td>VALUE</td><td>t<sub>final</sub> = t<sub>initial</sub> + s</td></tr><tr><td>AUGMENT</td><td>FRACTION</td><td>t<sub>final</sub> = t<sub>initial</sub> + (t<sub>initial</sub> * s)</td></tr><tr><td>REPLACE</td><td>VALUE</td><td>t<sub>final</sub> = s</td></tr><tr><td>REPLACE</td><td>FRACTION</td><td>t<sub>final</sub> = t<sub>initial</sub> * s</td></tr></tbody></table><p>In the above table:</p><ul><li>t = Spatial Data <em>target</em> cell</li><li>s = Grid ASCII map <em>source</em> value corresponding to t's location.</li><li>s values can be either positive or negative.</li><li>t<sub>final</sub> values are <em><em>not</em></em> checked to see if they have become negative. It is possible to inadvertently create negative values in a spatial data pool where negative values are not allowed or make no sense (e.g. <code>BIOMASS_LEAF_N</code>).</li><li>t and s values are <em><em>assumed</em></em> to share the same units. Modify-By-Map disturbances cannot perform unit conversions as part of modify a spatial data pool.</li></ul><h4><em>Metadata</em> Parameters (<strong>Don't Touch!</strong>)</h4><table><thead><tr><th>Parameter Name</th><th>Expected Value</th><th>Description</th><th>Can leave blank?</th></tr></thead><tbody><tr><td><code>modelClass</code></td><td><code>ModifySpatialDataByMapDisturbanceModel</code></td><td>Automatically set when JVelma a the Modify-By-Map item parameterization to a simulation configuration</td><td>NO</td></tr></tbody></table><p>The <code>modelClass</code> parameter is special and should never be changed from its initial value. It is used by the simulator to decide what disturbance code to load and run for this Modify-By-Map item parameterization.</p><h4><em>An Example Modify-By-Map Parameterization</em></h4><table><thead><tr><th>Parameter</th><th>Value</th></tr></thead><tbody><tr><td><code>initializeActiveLoops</code></td><td>1</td></tr><tr><td><code>initializeActiveYears</code></td><td>1969</td></tr><tr><td><code>initializeActiveJdays</code></td><td>1</td></tr><tr><td><code>occursAtStepStart</code></td><td>false</td></tr><tr><td><code>spatialDataName</code></td><td><code>BIOMASS_LEAF_N</code></td></tr><tr><td><code>spatialDataLayer</code></td><td>1</td></tr><tr><td><code>setCellOutcome</code></td><td><code>REPLACE</code></td></tr><tr><td><code>setMapValueMode</code></td><td><code>VALUE</code></td></tr><tr><td><code>spatialDataFileFullName</code></td><td>./Every_Conifer_Cell_80d5.asc</td></tr><tr><td><code>modelClass</code></td><td><code>ModifySpatialDataByMapDisturbanceModel</code></td></tr></tbody></table><p>This example parameterization creates a <code>ModifySpatialDataByMapDisturbanceModel</code> instance that loads data from Grid ASCII map file <code>inputDataLocationRootName</code>/<code>inputDataLocationDirName</code>/Every_Conifer_Cell_80d5.asc and in the first simulation loop, on January 1, 1969 replaces each value of the <code>BIOMASS_LEAR_N</code> spatial data pool with the corresponding value from file Every_Conifer_Cell_80d5.asc. (<code>BIOMASS_LEAR_N</code> is a single-layer pool, so <code>spatialDataLayer</code>'s value <em>must</em> be 1.)</p><h3>Using Modify-By-Map Instead of Set-By-Map</h3><p>The <code>ModifySpatialDataByMapDisturbanceModel</code> became available in VELMA version 2.1.0.10. Prior to this version the SpatialData modification capability VELMA provided was the <code>SetSpatialDataByMapDisturbance</code> ("Set-By-Map"). Set-By-Map disturbances are functionally equivalent to Modify-By-Map disturbances parameterized with <code>setCellOutcome</code>=<code>REPLACE</code> and <code>setMapValueMode</code>=<code>VALUE</code>.</p><p>VELMA still supports Set-By-Map disturbances (for legacy simulation configuration .xml) but now that Modify-By-Map disturbances are available, there is no reason to use Set-By-Map disturbances.</p></div></body><footer id="footer"><p>VELMA 2.2 DOCUMENTATION</p></footer></html>