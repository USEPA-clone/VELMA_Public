<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width">
  <meta name="charset" content="utf-8">
  <link rel="stylesheet" type="text/css" href="/style.css">
  <title></title>

<body class="bg-primary">
  <div class="header blue-base">
    <nav class="navbar blue-base navbar-expand"><a class="navbar-brand" href="/index.html">VELMA 2.2 HOME</a>
      <ul class="navbar-nav no-bullets">
        <li class="nav-item"><a class="nav-link" href="/intro.html"><span>I. Intro</span></a></li>
        <li class="nav-item"><a class="nav-link" href="/changes.html"><span>II. Changes from 1.0</span></a></li>
        <li class="nav-item"><a class="nav-link" href="/about.html"><span>III. About</span></a></li>
        <li class="nav-item"><a class="nav-link" href="/input_files.html"><span>IV. Input Files </span></a></li>
        <li class="nav-item"><a class="nav-link" href="/new_sim_config.html"><span>V. Sim Config</span></a></li>
        <li class="nav-item"><a class="nav-link" href="/parameter_config.html"><span>VI. Parameter Config</span></a></li>
        <li class="nav-item dropdown">Appendicies<ul class="nav-dropdown blue-light">
            <li class="nav-item"><a class="nav-link" href="/appendix_1.html"><span>Appendix 1</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/appendix_2.html"><span>Appendix 2</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/appendix_3.html"><span>Appendix 3</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/appendix_4.html"><span>Appendix 4</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/appendix_5.html"><span>Appendix 5</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/appendix_6.html"><span>Appendix 6</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/appendix_7.html"><span>Appendix 7</span></a></li>
          </ul>
        </li>
        <li class="nav-item dropdown">Supplemental <ul class="nav-dropdown blue-light">
            <li class="nav-item"><a class="nav-link" href="/supplement-a1.html"><span>Supplement A1</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-a2.html"><span>Supplement A2</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-a3.html"><span>Supplement A3</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-a4.html"><span>Supplement A4</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b1.html"><span>Supplement B1</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b2.html"><span>Supplement B2</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b3.html"><span>Supplement B3</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b4.html"><span>Supplement B4</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b5.html"><span>Supplement B5</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b6.html"><span>Supplement B6</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b7.html"><span>Supplement B7</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b8.html"><span>Supplement B8</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b9.html"><span>Supplement B9</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b10.html"><span>Supplement B10</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-c1.html"><span>Supplement C1</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-c2.html"><span>Supplement C2</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-c3.html"><span>Supplement C3</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d1.html"><span>Supplement D1</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d2.html"><span>Supplement D2</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d3.html"><span>Supplement D3</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d4.html"><span>Supplement D4</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d5.html"><span>Supplement D5</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d6.html"><span>Supplement D6</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d7a.html"><span>Supplement D7a</span></a></li>
                        <li class="nav-item"><a class="nav-link" href="/supplement-d7b.html"><span>Supplement D7b</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d8.html"><span>Supplement D8</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d9.html"><span>Supplement D9</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d10.html"><span>Supplement D10</span></a></li>
          </ul>
        </li>
        <li class="nav-item dropdown"> <a class="nav-link" href="/dev_info.html"><span>Developer Info</span></a>
          <ul class="nav-dropdown blue-light">
            <li class="nav-item"><a class="nav-link" href="/GetVelma_ForEclipse.html"><span>Clone Github to Local Machine</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/CellSpecificBurnDisturbance_Configuration_Guide.html"><span>Cell Specific Burn Disturbance Config Guide</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/Configuration_Checker_Guide.html"><span>Configuration Checker Guide</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/DefaultSedimentModel_Configuration_Guide.html"><span>Default Sediment Model Config Guide</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/ForestBurnLsrDisturbanceModel_Overview.html"><span>Forest Burn LSR Disturbance Model</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/JPDEM_ReachMapping_Demonstration.html"><span>JPDEM Reaching Mapping Demo</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/MinMaxAirT_WeatherDrivers.html"><span>Min Max Air Temp Weather Drivers</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/ModifySpatialDataByMap_Guide.html"><span>Modify Spatial Data by Map Guide</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/ObsRunoff_and_NaNs.html"><span>OBS Runnoff and NaNs</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/OrganicContaminant_Overview.html"><span>Organic Contaminant Overview</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/OrganicContaminant_Remediation_Configuration_Guide.html"><span>Organic Contaminant Redemption Config Guide</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/OrganicContaminant_Tracer_Configuration_Guide.html"><span>Organic Contaminant Tracter Config Guide</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/ReachSpecificObservedRunnoff.html"><span>Reach Specific Observed Runnoff</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/Sediment_Output_Data_Summary.html"><span>Sediment Output Data Summary</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/SnowDepth_Initialization_Guide.html"><span>Snow Depth Initialization Guide</span></a></li>
          </ul>
        </li>
        <li class="nav-item dropdown"> <a class="nav-link" href="/dev_utils.html"><span>Developer Utils</span></a>
          <ul class="nav-dropdown blue-light">
            <li class="nav-item"><a class="nav-link" href="/AscMapOct_Guide.html"><span>Ascii Map Oct Guide </span></a></li>
            <li class="nav-item"><a class="nav-link" href="/AscRangeMask_Guide.html"><span>Ascii Range Mask Guide</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/MoeVelGenerator_Guide.html"><span>MOEA-to-VELMA Configuration Generator</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/NashSutcliffeCalculator_Guide.html"><span>Tool for Computing Nash-Sutcliffe Coefficients</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/NseQuarts_Guide.html"><span>NseQuarts Guide</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/VelmaSimRunner_QuickRef.html"><span>VelmaSimRunner Quick Reference</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/VelmaSimRunner.html"><span>VelmaSimRunner Full Guide</span></a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </div>
  <div class="main_body">
    <div class="container">
      <h1>Minimum and Maximum Air Temperatures In VELMA</h1>
      <h2>Overview</h2>
      <p>Four of VELMA's six existing weather models now support specification of daily (i.e. per-step) minimum and/or maximum air temperature (&quot;airT&quot;) values.</p>
      <table>
        <thead>
          <tr>
            <th>Weather Model</th>
            <th>Min/Max AirT Support?</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>DefaultWeatherModel</td>
            <td>Yes</td>
            <td>For Min/Max AirT support use <code>weatherDriverDataFileName</code> parameter and single weather driver data file.</td>
          </tr>
          <tr>
            <td>SingleLocationWeatherModel</td>
            <td>Yes</td>
            <td>Not selectable in JVelma GUI.&lt;br&gt;Use DefaultWeatherModel instead: it has identical behavior.</td>
          </tr>
          <tr>
            <td>MapDrivenWeatherModel</td>
            <td>No</td>
            <td>Not selectable in JVelma GUI.&lt;br&gt;For VELMA developer use only.</td>
          </tr>
          <tr>
            <td>MultipleLocationWeatherModel</td>
            <td>Yes</td>
            <td>Cell-specific values are provided by the nearest weather station driver data.</td>
          </tr>
          <tr>
            <td>MultipleWeightedLocationWeatherModel</td>
            <td>Yes</td>
            <td>Cell-specific values are weighted average of all weather station values.</td>
          </tr>
          <tr>
            <td>SpatialWeatherModel</td>
            <td>No</td>
            <td>Implementation possible, but pending verification of how to compute cell-specific value from driver data.</td>
          </tr>
        </tbody>
      </table>
      <p>Specifying min/max airT values is optional, but when they are provided, they may be accessed by the VELMA simulator engine and its sub-models.
        Currently, the only sub-model that uses min/max airT values is the SurfaceEvaporationModel.</p>
      <p>Min and max airT values are reported in columns of a VELMA simulation results <code>DailyResults.csv</code> file and the files derived from it (<code>Combined_DailyResults.csv</code> and <code>AnnualResults.csv</code>).
        They are also reported in columns of the <code>Cell_*.csv</code> files for any <code>CellDataWriter</code> parameterizations configured for the simulation run.</p>
      <h2>How to Specify Min/Max AirT Values</h2>
      <p>Like all weather driver data, when minimum and or maximum air temperature driver data is provided for simulation configuration, it must be provided for every day (simulation step) within the range of years specified by the <code>forcing_start</code> and <code>forcing_end</code> configuration parameters.</p>
      <blockquote>
        <p>Example:<br>
          Suppose <code>forcing_start=1999</code> and <code>forcing_end=2000</code>, then <code>365 + 366 = 731</code> total values are required for each driver data category.</p>
      </blockquote>
      <p><em>Unlike</em> other weather driver data, when a minumum or maximum air temperature driver data value is missing, the simulation will not fail with an error.
        However, the simulation will run behaving as if there is no minimum and/or maximum (depending upon what is missing) air temperature driver data at all.
        In such cases, all minimum and/or maximum air temperature values are reports as <code>NaN</code>.</p>
      <p>All the VELMA weather models that support min/max airT values expect weather station driver data to be provided in one or more .csv files.
        Each file should have one row of driver data per simulation step, and each row must provide the following values in the following order:</p>
      <pre><code>Year,Jday,Precipitation,Average_AirT,Minumum_AirT,Maximum_AirT
</code></pre>
      <p>Where:</p>
      <ul>
        <li>
          <p><strong><code>Year</code></strong>
            is the year this driver data is for.
            This value must be a four-digit integer.</p>
        </li>
        <li>
          <p><strong><code>Jday</code></strong>
            is the Julian day this driver data is for.
            This value must be an integer in the range [1, 366].</p>
        </li>
        <li>
          <p><strong><code>Precipitation</code></strong>
            is the amount of precipitation (in mm) on <code>Year</code>, <code>Jday</code>.
            This value must be a non-negative floating-point or integer value.</p>
        </li>
        <li>
          <p><strong><code>Average_AirT</code></strong>
            The average air temperature (in degrees C) on <code>Year</code>, <code>Jday</code>.
            This value must be a floating-point or integer value.</p>
        </li>
        <li>
          <p><strong><code>Minimum_AirT</code></strong>
            The minimum air temperature (in degrees C) on <code>Year</code>, <code>Jday</code>.
            This value must be a floating-point or integer value.</p>
        </li>
        <li>
          <p><strong><code>Maximum_AirT</code></strong>
            The maximum air temperature (in degrees C) on <code>Year</code>, <code>Jday</code>.
            This value must be a floating-point or integer value.</p>
        </li>
      </ul>
      <p>A weather station driver data .csv file <em>must</em> specify the <code>Year</code>, <code>Jday</code>, <code>Precipitation</code>, and <code>Average_AirT</code> values, but the <code>Minimum_AirT</code> and <code>Maximum_AirT</code> values are optional.</p>
      <p>The following row formats are all valid and allowed:<br>
        <em>(n.b. field names have been abbreviated to reduce the table width.)</em>
      </p>
      <table>
        <thead>
          <tr>
            <th>Data Row Format</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Year,Jday,Precip,Ave_AirT,Min_AirT,Max_AirT</code></td>
            <td>Specifies all possible driver data</td>
          </tr>
          <tr>
            <td><code>Year,Jday,Precip,Ave_AirT,Min_AirT</code></td>
            <td>Specifies minimum airT, but not maximum airT.&lt;br&gt;Note: do <em>not</em> include a right-hand, trailing ',' (comma).&lt;br&gt;Max airT always reported as <code>NaN</code>.</td>
          </tr>
          <tr>
            <td><code>Year,Jday,Precip,Ave_AirT,,Max_AirT</code></td>
            <td>Specifies minimum airT, but not maximum airT&lt;br&gt;Note: the ',,' &quot;empty&quot; field for the missing minimum airT is <strong><em>required</em></strong>.&lt;br&gt;Min airT always reported as <code>NaN</code>.</td>
          </tr>
          <tr>
            <td><code>Year,Jday,Precip,Ave_AirT</code></td>
            <td>Only specifies required driver data.&lt;br&gt;Note: do <em>not</em> include a right-hand, trailing ',' (comma).&lt;br&gt;Both min and max airT always reported as <code>NaN</code>.</td>
          </tr>
        </tbody>
      </table>
      <h2>Model-Specific Details</h2>
      <h3><code>DefaultWeatherModel</code></h3>
      <p>Prior to supporting min/max airT values, the <code>DefaultWeatherModel</code> used two separate configuration parameters to specify two separate driver data files one for precipitation, and one for (average) air temperature.
        To support legacy use, those parameters still exist, but new simulation configurations should specify a single driver data file (in the format described above) to the <code>weatherDriverDataFileName</code> configuration parameter.<br>
        When the <code>weatherDriverDataFileName</code> is specified, the two legacy parameters are ignored, and data is loaded <em>only</em> from the single driver data file.
        However, when <code>weatherDriverDataFileName</code> is left unspecified (i.e. blank), the <code>DefaultWeatherModel</code> will try to load data via the two legacy parameters, and will expect those parameters to specify valid driver data files in the legacy format.</p>
      <h3><code>SingleLocationWeatherModel</code></h3>
      <p>The <code>SingleLocationWeatherModel</code> is not intended for direct specification by VELMA users.<br>
        It is used &quot;underneath&quot; the <code>MultipleLocationWeatherModel</code>.
        VELMA users configuring a simulation should use <code>DefaultWeatherModel</code>, which is the selectable, functional equivalent of <code>SingleWeatherModel</code>.</p>
      <h3><code>MultipleLocationWeatherModel</code></h3>
      <p>Each weather station driver data file specified in a row of the <code>weatherLocationsDataFileName</code> configuration parameter's .csv list of locations and weather stations can specify min and/or max airT values by following the format described above.</p>
      <p>The &quot;all or nothing&quot; rule for one driver data file applies across <em>all</em> weather station driver date files. If <em>any</em> station is missing even one min or max airT value, <em>every</em> weather station behaves as if <em>no</em> min or max airT values exist.</p>
      <h3><code>MultipleWeightedLocationWeatherModel</code></h3>
      <p>Each weather station driver data file specified in a row of the <code>weatherLocationsDataFileName</code> configuration parameter's .csv list of locations and weather stations can specify min and/or max airT values by following the format described above.</p>
      <p>The &quot;all or nothing&quot; rule for one driver data file applies across <em>all</em> weather station driver date files. If <em>any</em> station is missing even one min or max airT value, <em>every</em> weather station behaves as if <em>no</em> min or max airT values exist.</p>
      <p><code>MultipleWeightedLocationWeatherModel</code> computes cell-specific values as a weighted distance average of all specified weather station values: review min and max airT simulation value carefully.</p>
      <h2>Appendix A: Notes for VELMA Developers</h2>
      <p>Minimum and maximum air temperature support was added to VELMA code base by declaring new methods in the <code>IWeatherModel</code> interface:</p>
      <pre><code>[ . . . ]
    public float getMinAirTemperature(int iCell, ISimulatorClock clock);
    public float getMaxAirTemperature(int iCell, ISimulatorClock clock);
    public boolean hasMinAirTemperatureData();
    public boolean hasMaxAirTemperatureData();
[ . . . ]
</code></pre>
      <p>The <code>BaseWeatherModel</code> class acts as a base-level implementor of <code>IWeatherModel</code>.
        It was updated with stub methods that behave as follows:</p>
      <ul>
        <li><code>BaseWeatherModel.getMinAirTemperature</code> always returns <code>Float.NaN</code>.</li>
        <li><code>BaseWeatherModel.getMaxAirTemperature</code> always returns <code>Float.NaN</code>.</li>
        <li><code>BaseWeatherModel.hasMinAirTemperatureData</code> always returns <code>false</code>.</li>
        <li><code>BaseWeatherModel.hasMaxAirTemperatureData</code> always returns <code>false</code>.</li>
      </ul>
      <p>All six existing VELMA weather model extend <code>BaseWeatherModel</code>, so even if a specific weather model hasn't been updated to support min/max airT data (e.g. <code>SpatialWeatherModel</code>), the above four functions are available and return consistent, correct (for weather models without min/max airT support) values.</p>
      <p>Specific weather models (e.g. <code>DefaultWeatherModel</code>) that <em>have</em> been updated to support min/max airT values override the <code>BaseWeatherModel</code> stub method implementations to provide actual min and/or max airT data, depending, of course, on what the driver data file(s) of a simulation configuration provide.</p>
      <p>The <code>GlobalState</code> class further wraps a given simulation instance's weather model object's calls with methods that do not require passing in the simulator clock:</p>
      <pre><code>[ . . . ]
   public float getMinAirTemperature(int iCell)
   public float getMaxAirTemperature(int iCell)
   public boolean hasMinAirTemperatureData()
   public boolean hasMaxAirTemperatureData()
[ . . . ]
</code></pre>
      <p>These methods call the corresponding underlying weather model method with the current simulation step, and are what other sub-model code (e.g. a <code>SurfaceEvaporationModel</code> object instance) are expected to call to determine whether min/max airT values are available (the <code>have...</code> methods) and what those values are (the <code>get...</code> methods).</p>

    </div>
  </div>
</body>
<footer id="footer">
  <p>VELMA 2.2 DOCUMENTATION</p>
</footer>
</head>

</html>