<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width">
  <meta name="charset" content="utf-8">
  <link rel="stylesheet" type="text/css" href="/style.css">
  <title></title>

<body class="bg-primary">
  <div class="header blue-base">
    <nav class="navbar blue-base navbar-expand"><a class="navbar-brand" href="/index.html">VELMA 2.2 HOME</a>
      <ul class="navbar-nav no-bullets">
        <li class="nav-item"><a class="nav-link" href="/intro.html"><span>I. Intro</span></a></li>
        <li class="nav-item"><a class="nav-link" href="/changes.html"><span>II. Changes from 1.0</span></a></li>
        <li class="nav-item"><a class="nav-link" href="/about.html"><span>III. About</span></a></li>
        <li class="nav-item"><a class="nav-link" href="/input_files.html"><span>IV. Input Files </span></a></li>
        <li class="nav-item"><a class="nav-link" href="/new_sim_config.html"><span>V. Sim Config</span></a></li>
        <li class="nav-item"><a class="nav-link" href="/parameter_config.html"><span>VI. Parameter Config</span></a></li>
        <li class="nav-item dropdown">Appendicies<ul class="nav-dropdown blue-light">
            <li class="nav-item"><a class="nav-link" href="/appendix_1.html"><span>Appendix 1</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/appendix_2.html"><span>Appendix 2</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/appendix_3.html"><span>Appendix 3</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/appendix_4.html"><span>Appendix 4</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/appendix_5.html"><span>Appendix 5</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/appendix_6.html"><span>Appendix 6</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/appendix_7.html"><span>Appendix 7</span></a></li>
          </ul>
        </li>
        <li class="nav-item dropdown">Supplemental <ul class="nav-dropdown blue-light">
            <li class="nav-item"><a class="nav-link" href="/supplement-a1.html"><span>Supplement A1</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-a2.html"><span>Supplement A2</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-a3.html"><span>Supplement A3</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-a4.html"><span>Supplement A4</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b1.html"><span>Supplement B1</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b2.html"><span>Supplement B2</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b3.html"><span>Supplement B3</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b4.html"><span>Supplement B4</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b5.html"><span>Supplement B5</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b6.html"><span>Supplement B6</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b7.html"><span>Supplement B7</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b8.html"><span>Supplement B8</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b9.html"><span>Supplement B9</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-b10.html"><span>Supplement B10</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-c1.html"><span>Supplement C1</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-c2.html"><span>Supplement C2</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-c3.html"><span>Supplement C3</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d1.html"><span>Supplement D1</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d2.html"><span>Supplement D2</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d3.html"><span>Supplement D3</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d4.html"><span>Supplement D4</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d5.html"><span>Supplement D5</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d6.html"><span>Supplement D6</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d7a.html"><span>Supplement D7a</span></a></li>
                        <li class="nav-item"><a class="nav-link" href="/supplement-d7b.html"><span>Supplement D7b</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d8.html"><span>Supplement D8</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d9.html"><span>Supplement D9</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/supplement-d10.html"><span>Supplement D10</span></a></li>
          </ul>
        </li>
        <li class="nav-item dropdown"> <a class="nav-link" href="/dev_info.html"><span>Developer Info</span></a>
          <ul class="nav-dropdown blue-light">
            <li class="nav-item"><a class="nav-link" href="/GetVelma_ForEclipse.html"><span>Clone Github to Local Machine</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/CellSpecificBurnDisturbance_Configuration_Guide.html"><span>Cell Specific Burn Disturbance Config Guide</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/Configuration_Checker_Guide.html"><span>Configuration Checker Guide</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/DefaultSedimentModel_Configuration_Guide.html"><span>Default Sediment Model Config Guide</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/ForestBurnLsrDisturbanceModel_Overview.html"><span>Forest Burn LSR Disturbance Model</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/JPDEM_ReachMapping_Demonstration.html"><span>JPDEM Reaching Mapping Demo</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/MinMaxAirT_WeatherDrivers.html"><span>Min Max Air Temp Weather Drivers</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/ModifySpatialDataByMap_Guide.html"><span>Modify Spatial Data by Map Guide</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/ObsRunoff_and_NaNs.html"><span>OBS Runnoff and NaNs</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/OrganicContaminant_Overview.html"><span>Organic Contaminant Overview</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/OrganicContaminant_Remediation_Configuration_Guide.html"><span>Organic Contaminant Redemption Config Guide</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/OrganicContaminant_Tracer_Configuration_Guide.html"><span>Organic Contaminant Tracter Config Guide</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/ReachSpecificObservedRunnoff.html"><span>Reach Specific Observed Runnoff</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/Sediment_Output_Data_Summary.html"><span>Sediment Output Data Summary</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/SnowDepth_Initialization_Guide.html"><span>Snow Depth Initialization Guide</span></a></li>
          </ul>
        </li>
        <li class="nav-item dropdown"> <a class="nav-link" href="/dev_utils.html"><span>Developer Utils</span></a>
          <ul class="nav-dropdown blue-light">
            <li class="nav-item"><a class="nav-link" href="/AscMapOct_Guide.html"><span>Ascii Map Oct Guide </span></a></li>
            <li class="nav-item"><a class="nav-link" href="/AscRangeMask_Guide.html"><span>Ascii Range Mask Guide</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/MoeVelGenerator_Guide.html"><span>MOEA-to-VELMA Configuration Generator</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/NashSutcliffeCalculator_Guide.html"><span>Tool for Computing Nash-Sutcliffe Coefficients</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/NseQuarts_Guide.html"><span>NseQuarts Guide</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/VelmaSimRunner_QuickRef.html"><span>VelmaSimRunner Quick Reference</span></a></li>
            <li class="nav-item"><a class="nav-link" href="/VelmaSimRunner.html"><span>VelmaSimRunner Full Guide</span></a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </div>
  <div class="main_body">
    <div class="container">
      <h1>JPDEM Sub-Reach Delineations</h1>
      <h2><em>An Interactive Demonstration</em></h2>
      <p>JPDEM provides a set of functions that allow you to determine a collection of outlets for sub-delineations of an overall watershed's area.</p>
      <p>Once identified, the collection of outlets can be specified as the <code>initialReachOutlets</code> of a VELMA simulation configuration, for <code>MULTI_MODE</code> simulation runs via either JVelma, or VelmaParllelCmdLine.</p>
      <p>This document demonstrates the JPDEM functions available for interactively determining a collection of outlets.</p>
      <h3>Generate flow accumulation (&quot;facc&quot;) data</h3>
      <ol>
        <li>In JPDEM, load an already-flat-processed Grid .asc DEM map (or, load an unprocessed DEM, and flat-process it.<br>
          Here's our example DEM loaded into JDPEM:<br>
          (The default display shows elevation values in red-scale: black cells have the lowest elevation, brightest red cells have the highest.)</li>
      </ol>
      <p><img src="public/image-ws109_dem_in_jpdem.PNG" alt="Example DEM in JDPEM"></p>
      <ol start="2">
        <li>Generate flow accumulation data for the DEM.
          <em>JPDEM's reach mapping functions assume flow accumulation is available, and will behave abnormally if it is not.</em><br>
          Select the JPDEM <code>Tools</code> --&gt; <code>Determine Flow Data</code> menu item, and JPDEM will generate flow accumulation data for each cell in the DEM.
          After generating facc data for our example DEM, JPDEM shifts the display to show facc cell values in grey-scale.
          Cells with higher flow accumulation values are darker.
        </li>
      </ol>
      <p><img src="public/image-ws109_facc_menu_item-cropped.PNG" alt="JPDEM Flow Data menu item"></p>
      <p><img src="public/image-ws109_facc_in_jpdem.PNG" alt="Example Flow Data in JPDEM"></p>
      <ol start="3">
        <li>Show the High-facc Cells
          To better distinguish cells with higher facc values, toggle the <code>Facc Threshold</code> checkbox and (for our example DEM) set the type, value pair to <code>Linear</code> and &quot;50&quot;.<br>
          All cells in the DEM that have facc values equal or greater than the specified threshold will be colored red.</li>
      </ol>
      <p><img src="public/image-ws109_facc_threshold_cropped.PNG" alt="Facc Threshold Controls"></p>
      <h3>Set the Primary Outlet</h3>
      <p>The Primary Outlet designates the outlet for the entire watershed.
        All (sub-)outlets specified via JPDEM's reach mapping functions are assumed to be relative to the Primary Outlet's cell location.</p>
      <p>There two ways to set the primary outlet:</p>
      <ul>
        <li>Directly enter the x and y (column and row) coordinates into the <code>Outlet</code> fields on the main display.</li>
        <li>Mouse-click the cell location within the display, hold the mouse button down and drag the cursor to highlight the <code>Set As Primary Outlet</code> item, and finally, release the mouse button.</li>
      </ul>
      <p>In the mouse-click example screen-captured below, note that the cell we're selecting (circled in black) has a flow-accumulation (&quot;facc&quot;) value of 1778. This means that the full watershed delineated from this primary outlet contains 1778 cells.</p>
      <p><img src="public/image-ws109_cell_popup_set_primary_edited.PNG" alt="Set primary outlet via popup menu"></p>
      <h3>Add Sub-Outlets to JPDEM's Outlets Set</h3>
      <p>JPDEM maintains a set of cell locations call the 'Outlets Set'. The Outlets Set is a proper set: no cell location can appear in it more than once.</p>
      <p>There are three ways to add cell locations to the Outlets Set.</p>
      <ul>
        <li>Mouse-click the cell location, hold and drag the cursor to highlight the <code>Add to Reach Map Outlets Set</code> item.</li>
        <li>Directly enter one or more cell locations via the <code>Tools</code> --&gt; <code>Add Multiple Outlets to Outlets Set</code> menu item.</li>
        <li>Automatically identify and add outlets via the <code>Tools</code> --&gt; <code>Auto-Add Multiple Outlets to Outlets Set</code> menu item.</li>
      </ul>
      <p>We'll start by adding some outlets using the mouse.
        Because we set the facc threshold to 50, we can easily identify cells with facc values of 50 or more.
        From setting the primary outlet via the mouse, we also know that the primary outlet has a fac value of 1778.
        Our basic strategy is to mouse-click on darker cells adjacent to facc-threshold cells and find values close to 50.
        We'll also consider facc-threshold cells themselves, if they're sufficiently far from the primary outlet.
        Here's a screen-capture showing the first cell we add to the Outlets Set:</p>
      <p><img src="public/image-ws109_cell_popup_add_outlet_edited.PNG" alt="Adding a cell to Outlets Set with the mouse"></p>
      <p>We continue on this for more cells, trying to select locations that are close to 50 or look like forks in the facc-threshold &quot;channels&quot;.
        As we add cells to the Outlets Set, JPDEM colors them green (a slightly lighter shade of green than the primary outlet).</p>
      <p><img src="public/image-ws109_multiple_outlets_displayed.PNG" alt="Multiple outlet cells in JPDEM"></p>
      <h3>Create a Reach Map</h3>
      <p>Once we think we have enough sub-outlets added to the Outlets Set, we can create a Reach Map.
        Creating a reach map is the way JPDEM figures out which cells in the full watershed belong to each of the sub-outlets in the Outlet Set. Clicking the <code>Tools</code> --&gt; <code>Create Create Reach Map Data from Outlets Set</code> menu item generates reach map data using the current Outlet Set.</p>
      <p><img src="public/image-ws109_createReachMap_menu_item_cropped.PNG" alt="Create Reach Map menu item"></p>
      <p>However, when we click <code>Create Create Reach Map Data from Outlets Set</code> we get the following options dialog:</p>
      <p><img src="public/image-ws109_createReachMap_addPrimary_optionDialog.PNG" alt="Create Reach Map add Primary Outlet Option Dialog"></p>
      <p>Although we've set the primary outlet at the correct location for our overall watershed, we haven't explicitly added it to the Outlets Set. JPDEM is offering to add it for us, let us proceed without it, or stop creating a Reach Map. For, now let's click &quot;No&quot;, and let the process move forward without including the primary outlet.</p>
      <p>JPDEM generates the Reach Map data, and displays a report of the results in a pop-up dialog window.</p>
      <p><img src="public/image-ws109_createReachMap_Results1_edited.PNG" alt="Create Reach Map Report v1"></p>
      <p>In the reach map result screen-captured above, note the red-underlined sub-reach at iOutlet=3387, with only 9 cells.
        We decide that a 9-cell sub-reach isn't worth keeping, and that we don't need this outlet in the Outlet Set.
        Fortunately, we can remove it using the mouse-click menu. When you mouse-click a cell that is a member of the Outlets Set, the mouse-click menu contains a <code>Remove Frome Reach Map Outlets Set</code> item:</p>
      <p><img src="public/image-ws109_cell_popup_remove_outlet.PNG" alt="Remove an outlet cell mouse menu item"></p>
      <p>After removing the under-cell'ed outlet from the Outlets Set, we click <code>Tools</code> --&gt; <code>Create Create Reach Map Data from Outlets Set</code> again. This time we get a warning that we will lose our previous reach map results (but <em>not</em> our Outlets Set).</p>
      <p><img src="public/image-ws109_reachMap_overwrite_ok_dialog.PNG" alt="Reach Map replacement warning dialog"></p>
      <p>Since we <em>do</em> want a new reach map, we lick <code>OK</code> and continue, again clicking &quot;No&quot; for the &quot;Add Primary Outlet&quot; option.
        The new report shows that the remaining sub-outlets all have a &quot;enough&quot; cells for our purposes, so we move on to see what the Reach Map looks like.</p>
      <h3>View the Reach Map</h3>
      <p>When Reach Map data is available, JPDEM has a (limited) way of displaying the sub-reaches spatially.
        Continuing on with the Outlets Set and Reach Map we created above, we click the <code>Tools</code> --&gt; <code>View Outlets, Reach State</code> --&gt; <code>View Reach Map</code> menu item:</p>
      <p><img src="public/image-ws109_viewReachMap_reachMap-menu_item_edited.PNG" alt="View Reach Map menu item"></p>
      <p><img src="public/image-ws109_viewReachMap_Display1.PNG" alt="Reach Map Display v1"></p>
      <p>The reach map is displayed at the same scale that JPDEM is set to when the <code>View Reach Map</code> item is clicked.
        Cells outside of the the watershed are colored black -- and, hang on, the above map doesn't look quite right, does it?<br>
        In fact, it <em>isn't</em> right -- but it <em>is</em> accurate.<br>
        What's <em>wrong</em> is that we neglected to include the primary outlet in our Outlet Set.
        We can verify this is the case by mouse-clicking on the outlet cell: the mouse-click menu does not include the <code>Remove Frome Reach Map Outlets Set</code> item.
        This means that the cell is not a member of the Outlets Set.
        We can add it by clicking the <code>Add to Reach Map Outlets Set</code> mouse-click menu item, or we can use the <code>Tools</code> --&gt; <code>Add Multiple Outlets to Outlets Set</code>,
        or we can simply run the <code>Create Create Reach Map Data from Outlets Set</code> item once again, and this time, click &quot;Yes&quot; for the &quot;Add Primary Outlet&quot; option.
        After doing so, the resulting report confirms that the primary outlet is now part of the Outlets Set, and the Reach Map viewer no longer looks &quot;wrong&quot;:</p>
      <p><img src="public/image-ws109_createReachMap_Results3_edited.PNG" alt="Create Reach Map Report v3"></p>
      <p><img src="public/image-ws109_viewReachMap_Display2.PNG" alt="Reach Map Display v2"></p>
      <h3>Use the Outlets Set in a VELMA Simulation Configuration</h3>
      <p>Once we're satisfied that the outlets in the Outlets Set form a satisfactory collection of watershed sub-reaches,
        we'd like to use that set of outlets in an appropriate VELMA simulation configuration.</p>
      <p>By &quot;appropriate&quot;, we mean that the VELMA simulation configuration should already be configured to use the same primary outlet location that we've been using in JPDEM.<br>
        <em>Neither JPDEM nor VELMA provides any automatic way to enforce this requirement</em>.
      </p>
      <p>Assuming we have an appropriate VELMA simulation configuration .xml file available, JDPEM's <code>File</code> --&gt; <code>Save Outlets Set As</code> --&gt; <code>Modified VELMA XML</code> menu item provides a way to transfer JPDEM's current Outlets Set to that .xml file.</p>
      <p><img src="public/image-ws109_save-to-velma_menu_item_cropped_edited.PNG" alt="Save Outlets Set menu item"></p>
      <p>The <code>Modified VELMA XML</code> item first asks for a VELMA .xml file to use as an initial source configuration:</p>
      <p><img src="public/image-ws109_save-to-velma_openSource_dialog_edited.PNG" alt="Open VELMA source file dialog"></p>
      <p>Use the &quot;Look In:&quot; drop-down control and the associated navigation buttons to locate the directory of the appropriate VELMA .xml file.<br>
        Click-select the VELMA .xml file itself in the files menu, and verify it in the &quot;File Name:&quot; text box.<br>
        Finally, click the &quot;Load File&quot; button to confirm this is the file to use.</p>
      <p>Once we've specified the appropriate VELMA .xml file, JPDEM performs the following actions:</p>
      <ol>
        <li>Opens the .xml file and reads the contents.</li>
        <li>Finds the <code>enableReachMapping</code> parameter and sets its value to <code>MULTI_MODE</code></li>
        <li>Finds the <code>initialReachOutlets</code> parameter and sets its value to the current Outlets Set.</li>
        <li>Opens a <code>Save Modified ...</code> dialog box to enable saving the changes just made.</li>
      </ol>
      <p>The <code>Save Modified ...</code> dialog box looks like this:</p>
      <p><img src="public/image-ws109_save-to-velma_saveTarget_dialog_edit.PNG" alt="Save VELMA target file dialog"></p>
      <p>Use the &quot;Save In:&quot; drop-down control and the associated navigation buttons to locate the directory to save the modified (or new) VELMA .xml file. The &quot;File Name:&quot; text box is initially set to the name of the VELMA source .xml file, if we want to overwrite that file's contents with our modified contents, then we can click the <code>Save File</code> button and be done.<br>
        However, we can also change the <code>File Name:</code>, to either overrite a different existing file <em>(not recommended)</em> or create a new file.</p>
      <p>Assuming we opt to create a new file, we can compare the original source file's <code>enableReachMapping</code> and <code>initialReachOutlets</code> parameters with the modified file's and confirm that JPDEM modified their values:<br>
        VELMA original .xml:</p>
      <pre><code>/calibration/VelmaInputs.properties/enableReachMapping, SOLO_MODE  
/calibration/VelmaInputs.properties/initialReachOutlets,
</code></pre>
      <p>VELMA modified .xml:</p>
      <pre><code>/calibration/VelmaInputs.properties/enableReachMapping, MULTI_MODE  
/calibration/VelmaInputs.properties/initialReachOutlets, 2433 3236 2181 3590 1735 4171 4172 1997 2094 2256 3408 2865 3505 2706 2866 3059 2260 3060 2620
</code></pre>
      <p>There is an alternate to transfer an Outlets Set from JPDEM to an appropriate VELMA .xml file.<br>
        It is arguably more straightforward, but it also involves more more steps.</p>
      <p>Open the JPDEM <code>Tools</code> --&gt; <code>View Outlets Report</code> and highlight-copy the &quot;simple list&quot; of outlets at the bottom of the report to the system clipboard by using pressing the <code>Ctrl</code>+<code>v</code> key combination.</p>
      <p><img src="public/image-ws109_viewReachMap_outlets-menu_item_edited.PNG" alt="View Outlets Report menu item"></p>
      <p><img src="public/image-ws109_outlets_report.PNG" alt="View Outlets Report window"></p>
      <p>Open JVelma, and load the appropriate simulation configuration .xml file, and edit the &quot;Sub-Reach Mapping Controls&quot; in the <code>Run Parameters</code> tab:</p>
      <p><img src="public/image-ws109_velma_run_parameters_cropped_edited.PNG" alt="VELMA Sub-Reach Mapping Controls"></p>
      <p>Use the drop-down selector to set the configuration to <code>MULTI_MODE</code> and paste the list of outlets copied from the JDPEM outlets report dialog into the adjacent text box by clicking on the text box and pressing the <code>Ctrl</code>+<code>p</code> key combination.</p>
      <p>If we plan to create a new simulation cofiguration .xml file from this modified original, we should also change the <code>Simulation Run Name</code> parameter (see the red question mark in the above image).</p>
      <p>Finally, use JVelma's <code>File</code> --&gt; <code>Save Configuration to VELMA XML File</code> menu item to save the MULTI_MODE, outlets-specified configuration.</p>

    </div>
  </div>
</body>
<footer id="footer">
  <p>VELMA 2.2 DOCUMENTATION</p>
</footer>
</head>

</html>