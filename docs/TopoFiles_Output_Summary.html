<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"><meta name="charset" content="utf-8"><link rel="stylesheet" type="text/css" href="/style.css"><title> </title></head><body class="bg-primary"><div class="header blue-base"><nav class="navbar blue-base navbar-expand"><a class="navbar-brand" href="/index.html">VELMA 2.2 HOME</a><ul class="navbar-nav no-bullets"><li class="nav-item"><a class="nav-link" href="/intro.html"><span>I. Intro</span></a></li><li class="nav-item"><a class="nav-link" href="/changes.html"><span>II. Changes from 1.0</span></a></li><li class="nav-item"><a class="nav-link" href="/about.html"><span>III. About</span></a></li><li class="nav-item"><a class="nav-link" href="/input_files.html"><span>IV. Input Files </span></a></li><li class="nav-item"><a class="nav-link" href="/new_sim_config.html"><span>V. Sim Config</span></a></li><li class="nav-item"><a class="nav-link" href="/parameter_config.html"><span>VI. Parameter Config</span></a></li><li class="nav-item dropdown">Appendicies<ul class="nav-dropdown blue-light"><li class="nav-item"><a class="nav-link" href="/appendix_1.html"><span>Appendix 1</span></a></li><li class="nav-item"><a class="nav-link" href="/appendix_2.html"><span>Appendix 2</span></a></li><li class="nav-item"><a class="nav-link" href="/appendix_3.html"><span>Appendix 3</span></a></li><li class="nav-item"><a class="nav-link" href="/appendix_4.html"><span>Appendix 4</span></a></li><li class="nav-item"><a class="nav-link" href="/appendix_5.html"><span>Appendix 5</span></a></li><li class="nav-item"><a class="nav-link" href="/appendix_6.html"><span>Appendix 6</span></a></li><li class="nav-item"><a class="nav-link" href="/appendix_7.html"><span>Appendix 7</span></a></li></ul></li><li class="nav-item dropdown">Supplemental <ul class="nav-dropdown blue-light"><li class="nav-item"><a class="nav-link" href="/supplement-a1.html"><span>Supplement A1</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-a2.html"><span>Supplement A2</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-a3.html"><span>Supplement A3</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-a4.html"><span>Supplement A4</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b1.html"><span>Supplement B1</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b2.html"><span>Supplement B2</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b3.html"><span>Supplement B3</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b4.html"><span>Supplement B4</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b5.html"><span>Supplement B5</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b6.html"><span>Supplement B6</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b7.html"><span>Supplement B7</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b8.html"><span>Supplement B8</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b9.html"><span>Supplement B9</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-b10.html"><span>Supplement B10</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-c1.html"><span>Supplement C1</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-c2.html"><span>Supplement C2</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-c3.html"><span>Supplement C3</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d1.html"><span>Supplement D1</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d2.html"><span>Supplement D2</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d3.html"><span>Supplement D3</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d4.html"><span>Supplement D4</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d5.html"><span>Supplement D5</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d6.html"><span>Supplement D6</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d7a.html"><span>Supplement D7a</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d7b.html"><span>Supplement D7b</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d8.html"><span>Supplement D8</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d9.html"><span>Supplement D9</span></a></li><li class="nav-item"><a class="nav-link" href="/supplement-d10.html"><span>Supplement D10</span></a></li></ul></li><li class="nav-item dropdown"> <a class="nav-link" href="/dev_info.html"><span>Developer Info</span></a><ul class="nav-dropdown blue-light"><li class="nav-item"><a class="nav-link" href="/GetVelma_ForEclipse.html"><span>Clone Github to Local Machine</span></a></li><li class="nav-item"><a class="nav-link" href="/CellSpecificBurnDisturbance_Configuration_Guide.html"><span>Cell Specific Burn Disturbance Config Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/Configuration_Checker_Guide.html"><span>Configuration Checker Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/DefaultSedimentModel_Configuration_Guide.html"><span>Default Sediment Model Config Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/Sediment_Output_Data_Summary.html"><span>Sediment Output Data Summary</span></a></li><li class="nav-item"><a class="nav-link" href="/ForestBurnLsrDisturbanceModel_Overview.html"><span>Forest Burn LSR Disturbance Model</span></a></li><li class="nav-item"><a class="nav-link" href="/JPDEM_ReachMapping_Demonstration.html"><span>JPDEM Reaching Mapping Demo</span></a></li><li class="nav-item"><a class="nav-link" href="/MinMaxAirT_WeatherDrivers.html"><span>Min Max Air Temp Weather Drivers</span></a></li><li class="nav-item"><a class="nav-link" href="/ModifySpatialDataByMap_Guide.html"><span>Modify Spatial Data by Map Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/ObsRunoff_and_NaNs.html"><span>OBS Runnoff and NaNs</span></a></li><li class="nav-item"><a class="nav-link" href="/OrganicContaminant_Overview.html"><span>Organic Contaminant Overview</span></a></li><li class="nav-item"><a class="nav-link" href="/OrganicContaminant_Remediation_Configuration_Guide.html"><span>Organic Contaminant Redemption Config Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/OrganicContaminant_Tracer_Configuration_Guide.html"><span>Organic Contaminant Tracter Config Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/ReachSpecificObservedRunnoff.html"><span>Reach Specific Observed Runnoff</span></a></li><li class="nav-item"><a class="nav-link" href="/SnowDepth_Initialization_Guide.html"><span>Snow Depth Initialization Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/TopoFiles_Output_Summary.html"><span>Topo Files Output Summary </span></a></li><li class="nav-item"><a class="nav-link" href="/VelmaParallel_Error_Reports.html"><span>Velma Parallel Error Reports</span></a></li><li class="nav-item"><a class="nav-link" href="/VelmaParallel_With_Multiple_Maps.html"><span>Velma Parallel With Multiple Maps </span></a></li><li class="nav-item"><a class="nav-link" href="/WaterDrainDisturbanceModel_Overview.html"><span>Water Drain Disturbance Model</span></a></li><li class="nav-item"><a class="nav-link" href="/VelmaSimulatorCmdLine_Overview.html"><span>Velma Sim Cmd Line Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/VelmaSimulatorAltCmdLine_Overview.html"><span>Velma Sim Alt Cmd Line Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/SurfaceEvaporation_Overview.html"><span>Surface Evaporation Overview</span></a></li></ul></li><li class="nav-item dropdown"> <a class="nav-link" href="/dev_utils.html"><span>Developer Utils</span></a><ul class="nav-dropdown blue-light"><li class="nav-item"><a class="nav-link" href="/AscMapOct_Guide.html"><span>Ascii Map Oct Guide </span></a></li><li class="nav-item"><a class="nav-link" href="/AscRangeMask_Guide.html"><span>Ascii Range Mask Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/MoeVelGenerator_Guide.html"><span>MOEA-to-VELMA Configuration Generator</span></a></li><li class="nav-item"><a class="nav-link" href="/NashSutcliffeCalculator_Guide.html"><span>Tool for Computing Nash-Sutcliffe Coefficients</span></a></li><li class="nav-item"><a class="nav-link" href="/NseQuarts_Guide.html"><span>NseQuarts Guide</span></a></li><li class="nav-item"><a class="nav-link" href="/VelmaSimRunner_QuickRef.html"><span>VelmaSimRunner Quick Reference</span></a></li><li class="nav-item"><a class="nav-link" href="/VelmaSimRunner.html"><span>VelmaSimRunner Full Guide</span></a></li></ul></li></ul></nav></div><div class="main_body container"><h1>VELMA Topography Output Data Summary</h1><h2>Overview</h2><p>VELMA configurations include a boolean-valued parameter named <code>enableTopographySpatialDataOutput</code> that defaults to <code>false</code>.<br> Setting it to <code>true</code> causes the VELMA simulator to write several <code>.asc</code> map files as part of its simulation results.</p><p>Each file written contains a specific topographic or watershed-related type of data, and each file name starts with a mnemonic indicating the data it contains.</p><table><thead><tr><th>File Prefix</th><th>File Data Description</th></tr></thead><tbody><tr><td><code>CHANNEL_</code></td><td>delineated cell channel identification mask</td></tr><tr><td><code>DEM_</code></td><td>cell elevation (in meters)</td></tr><tr><td><code>FACC_</code></td><td>cell flow accumulation value</td></tr><tr><td><code>FDIR_</code></td><td>cell primary flow direction indicator</td></tr><tr><td><code>FID_</code></td><td>delineated cell identification mask</td></tr><tr><td><code>SID_</code></td><td>delineated cell simulation sequence number</td></tr></tbody></table><p>Each file's name also contains the name provided as the configuration's <code>input_dem</code> parameter value, e.g. if <code>input_dem == my_dem_30m.asc</code>, then the <code>FID_</code> files full name would be <code>FID_my_dem_30m.asc</code>.</p><p>Collectively these files provide additional context about the results of the simulation run. In turn, that context may prove useful for changing the configuration's parameterization for subsequent runs ...</p><ul><li>as part of site calibration refinement.</li><li>for adapting the configuration to include additional simulation features (e.g. contaminant or sediment simulation)</li><li>as information for other models that may use the VELMA results as part of their own input.</li></ul><p>Although you must successfully start a VELMA simulation run in order to generate the topography output files, you do not need to wait until the simulation has completed in order to view their contents. When enabled, the topography output files are written as part of the first simulation step, and are available by the time the second simulation step has completed.</p><p>A common practice when calibrating a new simulation site is to create a simplified configuration file with <code>enableTopographySpatialDataOutput == true</code>, then stop the run after the 2nd simulation step. The topography files from this run can be used to further refine and revise the simplified configuration file's parameter values. (E.g. the <code>CHANNEL_</code> and/or <code>FACC_</code> map data can be used to determine placement of sub-reach outlets or cell data writers.)</p><h2>File Formats and Data Details</h2><p>All the files written will have the same grid dimensions and header information as the DEM file specified for the configuration's <code>input_dem</code> parameter <em>unless</em> the <code>trimTopographyOutputToWatershedBoundary</code> parameter has also been set <code>true</code>. In that case, the grid dimensions and x and y offsets of the topography file headers will be set to the bounding box of the delineated watershed.<br> Setting <code>trimTopographyOutputToWatershedBoundary == true</code> can be useful if your <code>input_dem</code> map is very large and your delineated area in that map is very small, however trimming is optional: <code>.asc</code> maps can be post-processed with GIS tools to trim them as-needed.</p><h3>The CHANNEL_ Map</h3><p>The <code>CHANNEL_</code> map contains ternary mask data that categorizes cells as follows:</p><table><thead><tr><th>Cell Value</th><th>Meaning</th></tr></thead><tbody><tr><td>-1</td><td>The cell is not part of the watershed delineation.</td></tr><tr><td>0</td><td>The cell is part of the delineation but not a channel cell.</td></tr><tr><td>1</td><td>The cell is part of the delineation and is a channel cell.</td></tr></tbody></table><p>A cell within the delineation is a channel cell IFF the log10 of its flow accumulation (<code>FACC_</code>) value is >= the configuration's <code>setChannelThreshold</code> value. (In the results directory, the <code>setChannelThreshold</code> value is stored in the <code>SimulationConfiguration[.csv,.xml]</code> files.)</p><blockquote><p>Note: typically, <code>setChannelThreshold == 2.5</code>, and it is considered unwise to change this default value without a deep understanding of how VELMA evaluates and computes runoff and loss amounts. Astute readers will note that the <code>CHANNEL_</code> map can be computed by overlaying the <code>FACC_</code> and <code>FID_</code> maps, and assigning values based on a cells log10(<code>FACC_</code>) and <code>FID_</code> map values.</p></blockquote><h3>The DEM_ Map</h3><p>The <code>DEM_</code> map is a copy of the map file specified for the configuration's <code>input_dem</code> parameter.<br> It is included in the results directory as a convenience, and for reference should the results directory become "separated" by time and location from the input data directory used by the VELMA simulator to generate the results.</p><h3>The FACC_ Map</h3><p>The <code>FACC_</code> map contains each cell's VELMA-computed flow accumulation value.<br> VELMA-computed flow accumulation values are related to, but are also distinct and different from JPDEM-computed flow accumulation values.</p><table><thead><tr><th>FACC value</th><th>Description</th></tr></thead><tbody><tr><td>JPDEM-computed</td><td>relative elevation based, accumulation of primary flow direction counts, integer values.</td></tr><tr><td>VELMA-computed</td><td>relative elevation based, accumulation of multiple-flow direction scores, floating-point values.</td></tr></tbody></table><p>VELMA flow accumulation is based on multiple flow directions. Each cell contributes 1 to its flow accumulation and each upstream cell that flows directly to it contributes an amount of its flow accumulation that is proportional to its water flow to the cell. The waterflow is the ratio of its slope to the sum of slopes of all cells that flow to the cell. This is distinct from the JPDEM flow accumulation calculation which simply sums the number of cells in a path of primary flow direction to the final headwater cell.</p><blockquote><p>Note: FACC_ map cells outside of the delineated watershed have the facc value "1.0", however some cells <em>within</em> the delineated watershed may also have a facc value of "1.0". Do not infer delineation status from a cell's facc value. Determine a cell's delineation status from the <code>FID_</code> map.</p></blockquote><h3>The FDIR_ Map</h3><p>The <code>FDIR_</code> map contains each cell's primary flow direction, as a integer-value direction identifier in the range [1, 8]. In VELMA a cell's primary flow direction is defined as the direction identifier of the downhill-adjacent cell with the largest slope, where slope is calculated as:</p><pre><code>(cell_elevation - downhill_adjacent_cell_elevation) / centroid_to_centroid_distance</code></pre><p>The following ascii-diagram inidicates which cell adjacent to cell "c" corresponds which direction code:</p><pre><code>+---+---+---+     The direction codes "start" 
| 6 | 7 | 8 |     at the cell east (to the right) of cell "c"
+---+---+---+     and continue clockwise around the eight
| 5 | c | 1 |     adjacent cells.
+---+---+---+  
| 4 | 3 | 2 |
+---+---+---+</code></pre><p>Any value outside the range [1, 8] indicates a cell without a valid flow direction, and is an indication that there were basic problems processing the original DEM grid map. If you find such values, re-evaluate your original DEM grid map: check that it is properly flat-processed, and passes JPDEM's flow test function.</p><h3>The FID_ Map</h3><p>The <code>FID_</code> map is a binary mask that distinguishes delineated and non-delineated cells.</p><table><thead><tr><th>Cell Value</th><th>Meaning</th></tr></thead><tbody><tr><td>-1</td><td>The cell is not part of the watershed delineation.</td></tr><tr><td>1</td><td>The cell is part of the delineation.</td></tr></tbody></table><p>The <code>FID_</code> map is primarily useful as an overlay mask when combining other VELMA data maps using either a GIS tool, or utility scripts like Python + GDAL or Numpy.</p><h3>The SID_ Map</h3><p>In the <code>SID_</code> map, each cell's value indicates its evaluation order within the VELMA simulation. The cell with value == "0" is the first cell processed, and the cell with the highest value is the last cell processed (and is also the outlet cell of the delineated watershed). Cells outside of the watershed are set to the value "-1". In each simulation step VELMA must process the delineated cells of the watershed in an order that ensures no cell's results (e.g. per-step water balance) are determined before any uphill-adjacent cells (whose results might affect its own) are processed. The sid ordering is how VELMA enforces this rule.</p></div></body><footer id="footer"><p>VELMA 2.2 DOCUMENTATION</p></footer></html>